<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= resume.basics.name %> - Resume</title>
    <!-- Use Configured Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">

    <!-- Inject Config Styles -->
    <style>
        :root {
            <% if (config.style.primaryColor) { %> --primary-color: <%= config.style.primaryColor %>; <% } %>
            <% if (config.style.secondaryColor) { %> --secondary-color: <%= config.style.secondaryColor %>; <% } %>
            <% if (config.style.accentColor) { %> --accent-color: <%= config.style.accentColor %>; <% } %>
            <% if (config.style.spacingScale) { %> --spacing-scale: <%= config.style.spacingScale %>; <% } %>
            <% if (config.style.fontSizeScale) { %> --font-size-scale: <%= config.style.fontSizeScale %>; <% } %>
            <% if (config.style.pagePaddingScale) { %> --page-padding-scale: <%= config.style.pagePaddingScale %>; <% } %>
            <% if (config.style.sectionGapScale) { %> --section-gap-scale: <%= config.style.sectionGapScale %>; <% } %>
        }
    </style>
</head>
<body>

    <a href="#" class="pdf-btn" onclick="window.print(); return false;">
        <i class="fas fa-file-pdf"></i> Save as PDF
    </a>

    <div class="sheet">
        <div class="resume-container">
            
            <!-- LEFT COLUMN: Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-wrapper">
                <% if (config.features.showPhoto && resume.basics.image) { %>
                    <img src="<%= resume.basics.image %>" alt="<%= resume.basics.name %>" class="avatar">
                <% } %>

                <section>
                    <h2><i class="fas fa-address-card"></i> Contact</h2>
                    
                    <div class="contact-item">
                        <div class="contact-icon"><i class="fas fa-envelope"></i></div>
                        <a href="mailto:<%= resume.basics.email %>"><%= resume.basics.email %></a>
                    </div>

                    <% if (resume.basics.phone) { %>
                    <div class="contact-item">
                        <div class="contact-icon"><i class="fas fa-phone"></i></div>
                        <%= resume.basics.phone %>
                    </div>
                    <% } %>

                    <% if (resume.basics.url) { %>
                    <div class="contact-item">
                        <div class="contact-icon"><i class="fas fa-globe"></i></div>
                        <a href="<%= resume.basics.url %>" target="_blank"><%= resume.basics.url.replace(/^https?:\/\//, '') %></a>
                    </div>
                    <% } %>

                    <% if (config.features.showLocation && resume.basics.location) { %>
                    <div class="contact-item">
                        <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <%= resume.basics.location.city %>, <%= resume.basics.location.country %>
                    </div>
                    <% } %>
                </section>

                <% if (resume.skills && resume.skills.length) { %>
                <section>
                    <h2><i class="fas fa-code"></i> Skills</h2>
                    <% resume.skills.forEach(function(skillGroup) { %>
                        <div class="item-group">
                            <div class="item-name">
                                <span><%= skillGroup.name %></span>
                            </div>
                            <div class="compact-grid">
                                <% skillGroup.keywords.forEach(function(keyword) { %>
                                    <% 
                                        var kName = typeof keyword === 'object' ? keyword.name : keyword;
                                        // Clamp level to max 3
                                        var rawLevel = typeof keyword === 'object' ? keyword.level : 0;
                                        var kLevel = Math.min(rawLevel, 3);
                                    %>
                                    
                                    <span class="item-tag <%= kLevel > 0 ? 'rated rated-' + kLevel : '' %>">
                                        <%= kName %>
                                    </span>

                                <% }); %>
                            </div>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.basics.profiles && resume.basics.profiles.length) { %>
                <section>
                    <h2><i class="fas fa-share-alt"></i> Social</h2>
                    <% resume.basics.profiles.forEach(function(profile) { %>
                        <div class="contact-item">
                            <i class="contact-icon 
                                <% if (profile.network.toLowerCase() === 'github') { %> fab fa-github
                                <% } else if (profile.network.toLowerCase() === 'linkedin') { %> fab fa-linkedin
                                <% } else if (profile.network.toLowerCase() === 'twitter' || profile.network.toLowerCase() === 'x') { %> fab fa-twitter
                                <% } else if (profile.network.toLowerCase() === 'facebook') { %> fab fa-facebook
                                <% } else if (profile.network.toLowerCase() === 'instagram') { %> fab fa-instagram
                                <% } else if (profile.network.toLowerCase() === 'stackoverflow') { %> fab fa-stack-overflow
                                <% } else if (profile.network.toLowerCase() === 'gitlab') { %> fab fa-gitlab
                                <% } else if (profile.network.toLowerCase() === 'bitbucket') { %> fab fa-bitbucket
                                <% } else { %> fas fa-link <% } %>
                            "></i>
                            <a href="<%= profile.url %>" target="_blank"><%= profile.username %></a>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.languages && resume.languages.length) { %>
                <section>
                    <h2><i class="fas fa-language"></i> Languages</h2>
                    
                        <% resume.languages.forEach(function(lang) { %>
                            <div class="item-group item-spread">
                                <span class="item-name"><%= lang.language %></span>
                                <span class="item-detail"><%= lang.fluency %></span>
                            </div>
                        <% }); %>
                    
                </section>
                <% } %>
                
                <% if (resume.interests && resume.interests.length) { %>
                <section>
                    <h2><i class="fas fa-heart"></i> Interests</h2>
                    <% 
                    var hasKeywords = resume.interests.some(i => i.keywords && i.keywords.length > 0);
                    if (hasKeywords) { 
                    %>
                        <% resume.interests.forEach(function(interest) { %>
                            <div class="item-group">
                                <div class="item-name"><%= interest.name %></div>
                                <% if (interest.keywords && interest.keywords.length) { %>
                                <div class="tags-container compact-grid">
                                    <% interest.keywords.forEach(function(keyword) { %>
                                        <% 
                                            var kName = typeof keyword === 'object' ? keyword.name : keyword;
                                            var kLevel = typeof keyword === 'object' ? keyword.level : 0;
                                        %>
                                        <span class="item-tag <%= kLevel > 0 ? 'rated rated-' + kLevel : '' %>">
                                            <%= kName %>
                                        </span>
                                    <% }); %>
                                </div>
                                <% } %>
                            </div>
                        <% }); %>
                    <% } else { %>
                         <div class="item-group"> <!-- Wrap in item-group for grid styling -->
                            <div class="tags-container compact-grid">
                                <% resume.interests.forEach(function(interest) { %>
                                    <% 
                                        var name = typeof interest === 'object' ? interest.name : interest;
                                        var icon = typeof interest === 'object' ? interest.icon : '';
                                    %>
                                    <div class="item-tag">
                                        <% if (icon) { %> <i class="<%= icon %>"></i> <% } %>
                                        <%= name %>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    <% } %>
                </section>
                <% } %>
                </div> <!-- End .sidebar-wrapper -->
            </aside>

            <!-- RIGHT COLUMN: Main Content -->
            <main class="main-content">
                <div class="content-wrapper">
                <header>
                    <h1><%= resume.basics.name %></h1>
                    <div class="profile-label">
                        <%= resume.basics.label %>
                    </div>
                    <% if (resume.basics.summary) { %>
                        <p class="summary">
                            <%= resume.basics.summary %>
                        </p>
                    <% } %>
                </header>

                <hr class="divider">

                <% if (resume.work && resume.work.length) { %>
                <section>
                    <h2><i class="fas fa-briefcase"></i> Experience</h2>
                    <% resume.work.forEach(function(job) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <h3 class="entry-title"><%= job.position %></h3>
                                    <div class="entry-subtitle">
                                        <% if (job.url) { %> 
                                            <a href="<%= job.url %>" target="_blank" title="<%= job.url %>"><%= job.name %> <i class="fas fa-external-link-alt external-link-icon"></i></a> 
                                        <% } else { %>
                                            <%= job.name %>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="entry-right">
                                    <div class="entry-date">
                                        <%= job.startDate %> — <%= job.endDate %>
                                    </div>
                                    <% if (config.features.showLocation && job.location) { %>
                                        <div class="entry-location"><%= job.location %></div>
                                    <% } %>
                                </div>
                            </div>
                            
                            <% if (job.summary) { %>
                                <p class="entry-summary"><%= job.summary %></p>
                            <% } %>

                            <% if (job.highlights && job.highlights.length) { %>
                                <ul class="entry-highlights">
                                <% job.highlights.forEach(function(highlight) { %>
                                    <li><%= highlight %></li>
                                <% }); %>
                                </ul>
                            <% } %>

                            <% if (job.keywords && job.keywords.length) { %>
                                <div class="entry-tags">
                                    <% job.keywords.forEach(function(keyword) { %>
                                        <% 
                                            var kName = typeof keyword === 'object' ? keyword.name : keyword;
                                            var kLevel = typeof keyword === 'object' ? keyword.level : 0;
                                        %>
                                        <span class="item-tag <%= kLevel > 0 ? 'rated rated-' + kLevel : '' %>">
                                            <%= kName %>
                                        </span>
                                    <% }); %>
                                </div>
                            <% } %>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.projects && resume.projects.length) { %>
                <section>
                    <h2><i class="fas fa-laptop-code"></i> Projects</h2>
                    <% resume.projects.forEach(function(project) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <h3 class="entry-title"><%= project.name %></h3>
                                </div>
                                <div class="entry-right">
                                    <% if (project.url) { %>
                                        <div class="entry-date text-accent"> 
                                            <a href="<%= project.url %>" target="_blank"><i class="fas fa-link"></i> Link</a>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            <p class="entry-summary"><%= project.description %></p>
                            <% if (project.keywords && project.keywords.length) { %>
                                <div class="entry-tags">
                                    <% project.keywords.forEach(function(keyword) { %>
                                        <% 
                                            var kName = typeof keyword === 'object' ? keyword.name : keyword;
                                            var kLevel = typeof keyword === 'object' ? keyword.level : 0;
                                        %>
                                        <span class="item-tag <%= kLevel > 0 ? 'rated rated-' + kLevel : '' %>">
                                            <%= kName %>
                                        </span>
                                    <% }); %>
                                </div>
                            <% } %>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.education && resume.education.length) { %>
                <section>
                    <h2><i class="fas fa-graduation-cap"></i> Education</h2>
                    <% resume.education.forEach(function(edu) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <h3 class="entry-title"><%= edu.studyType %> in <%= edu.area %></h3>
                                    <div class="entry-subtitle">
                                        <%= edu.institution %>
                                    </div>
                                    <% if (edu.score) { %>
                                        <div class="entry-summary"><%= edu.score %></div>
                                    <% } %>
                                </div>
                                <div class="entry-right">
                                    <div class="entry-date">
                                        <%= edu.startDate %> — <%= edu.endDate %>
                                    </div>
                                    <% if (config.features.showLocation && edu.location) { %>
                                        <div class="entry-location"><%= edu.location %></div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.certificates && resume.certificates.length) { %>
                <section>
                    <h2><i class="fas fa-certificate"></i> Certifications</h2>
                    <% resume.certificates.forEach(function(cert) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <h3 class="entry-title"><%= cert.name %></h3>
                                </div>
                                <div class="entry-right">
                                    <div class="entry-date"><%= cert.date %></div>
                                </div>
                            </div>
                            <div class="entry-subtitle"><%= cert.issuer %></div>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.awards && resume.awards.length) { %>
                <section>
                    <h2><i class="fas fa-trophy"></i> Awards</h2>
                    <% resume.awards.forEach(function(award) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <h3 class="entry-title"><%= award.title %></h3>
                                    <div class="entry-subtitle">
                                        <%= award.awarder %>
                                    </div>
                                    <div class="entry-summary"><%= award.summary %></div>
                                </div>
                                <div class="entry-right">
                                    <div class="entry-date"><%= award.date %></div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <% if (resume.publications && resume.publications.length) { %>
                <section>
                    <h2><i class="fas fa-book-open"></i> Publications</h2>
                    <% resume.publications.forEach(function(pub) { %>
                        <div class="entry">
                            <div class="entry-header">
                                <div class="entry-left">
                                    <% if (pub.url) { %> 
                                        <a href="<%= pub.url %>" target="_blank" class="entry-title" title="<%= pub.url %>"><%= pub.name %> <i class="fas fa-external-link-alt external-link-icon"></i></a> 
                                    <% } else { %>
                                        <h3 class="entry-title"><%= pub.name %></h3>
                                    <% } %>
                                    <div class="entry-subtitle">    
                                        <%= pub.publisher %>
                                    </div>
                                    <p class="entry-summary"><%= pub.summary %></p>
                                </div>
                                <div class="entry-right">
                                    <div class="entry-date">
                                        <%= pub.releaseDate %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </section>
                <% } %>

                <section>
                    <h2><i class="fas fa-check-circle"></i> References</h2>
                    <% if (resume.references && resume.references.length) { %>
                        <% resume.references.forEach(function(ref) { %>
                            <div class="entry-compact">
                                <h3 class="entry-title"><%= ref.name %></h3>
                                <div class="entry-subtitle"><%= ref.reference %></div>
                            </div>
                        <% }); %>
                        <p class="section-note">Contact details available upon request.</p>
                    <% } else { %>
                        <p class="section-note">References available upon request.</p>
                    <% } %>
                </section>
                </div> <!-- End .content-wrapper -->
            </main>
        </div>
    </div>

</body>
</html>
